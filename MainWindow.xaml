<Window x:Class="SoundRecorder.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:soundRecorder="clr-namespace:SoundRecorder"
        xmlns:prop="clr-namespace:SoundRecorder.Properties"
        Title="{x:Static prop:Resources.Window_Title}" Height="340" Width="400" FlowDirection="LeftToRight" Icon="app-icon.ico"
        WindowStyle="None" ResizeMode="NoResize">

    <Window.Resources>
        <soundRecorder:LevelToBrushConverter x:Key="LevelToBrushConverter"/>

        <!-- Close Button hover style -->
        <Style x:Key="CloseButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="Black"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="0">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#E81123"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#C50F1F"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.6"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="32"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Custom Title Bar -->
        <Grid x:Name="TitleBar" Grid.Row="0" Background="Transparent" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <Grid Grid.Column="0" HorizontalAlignment="Right">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=Title}"
                           VerticalAlignment="Center" Margin="10,0,10,0" TextTrimming="CharacterEllipsis" FlowDirection="RightToLeft" TextAlignment="Right"/>
                <Image Grid.Column="1" Width="16" Height="16" Margin="0,0,8,0" VerticalAlignment="Center"
                       Source="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=Icon}"/>
            </Grid>
            <Button x:Name="CloseButton" Grid.Column="1" Content="×" Width="46" Height="32" Click="CloseButton_Click" Style="{StaticResource CloseButtonStyle}"/>
        </Grid>

        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="10" FlowDirection="RightToLeft">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Vertical meters on the far-left, spanning rows 0..4 and aligning bottom with FileName row -->
            <StackPanel Grid.Row="0" Grid.RowSpan="5" Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Stretch" HorizontalAlignment="Left">
                <ProgressBar x:Name="RightLevelMeter" Width="10" Margin="0,0,5,0" Minimum="0" Maximum="100" Orientation="Vertical" VerticalAlignment="Stretch">
                    <ProgressBar.Foreground>
                        <Binding RelativeSource="{RelativeSource Self}" Path="Value" Converter="{StaticResource LevelToBrushConverter}"/>
                    </ProgressBar.Foreground>
                </ProgressBar>
                <ProgressBar x:Name="LeftLevelMeter" Width="10" Margin="0" Minimum="0" Maximum="100" Orientation="Vertical" VerticalAlignment="Stretch">
                    <ProgressBar.Foreground>
                        <Binding RelativeSource="{RelativeSource Self}" Path="Value" Converter="{StaticResource LevelToBrushConverter}"/>
                    </ProgressBar.Foreground>
                </ProgressBar>
            </StackPanel>

            <Label Grid.Row="0" Grid.Column="0" Content="{x:Static prop:Resources.Label_Source}" Margin="5" HorizontalAlignment="Right"/>
            <ComboBox Grid.Row="0" Grid.Column="1" x:Name="SourceComboBox" Margin="5" FlowDirection="LeftToRight"/>

            <Label Grid.Row="1" Grid.Column="0" Content="{x:Static prop:Resources.Label_Album}" Margin="5" HorizontalAlignment="Right"/>
            <ComboBox Grid.Row="1" Grid.Column="1" x:Name="AlbumComboBox" Margin="5" IsEditable="True" FlowDirection="RightToLeft"/>

            <Label Grid.Row="2" Grid.Column="0" Content="{x:Static prop:Resources.Label_Genre}" Margin="5" HorizontalAlignment="Right"/>
            <ComboBox Grid.Row="2" Grid.Column="1" x:Name="GenreComboBox" Margin="5" IsEditable="True" FlowDirection="RightToLeft"/>

            <Label Grid.Row="3" Grid.Column="0" Content="{x:Static prop:Resources.Label_Singer}" Margin="5" HorizontalAlignment="Right"/>
            <ComboBox Grid.Row="3" Grid.Column="1" x:Name="SingerComboBox" Margin="5" IsEditable="True" 
                      SelectionChanged="SingerComboBox_SelectionChanged" TextBoxBase.TextChanged="SingerComboBox_TextChanged" FlowDirection="RightToLeft"/>

            <Label Grid.Row="4" Grid.Column="0" Content="{x:Static prop:Resources.Label_FileName}" Margin="5" HorizontalAlignment="Right"/>
            <TextBox Grid.Row="4" Grid.Column="1" x:Name="FileNameTextBox" Margin="5" FlowDirection="RightToLeft"/>

            <StackPanel Grid.Row="5" Grid.ColumnSpan="3" Orientation="Horizontal" HorizontalAlignment="Center" Margin="10" FlowDirection="LeftToRight">
                <TextBlock x:Name="RecordingTimeText" Text="{x:Static prop:Resources.RecordingTime_Initial}" Foreground="Red" FontSize="32" VerticalAlignment="Center" Margin="0,5,10,5" Width="200" TextAlignment="Center"/>
                <Button x:Name="StartButton" Width="64" Height="64" Margin="5" Click="StartButton_Click" Background="Transparent" BorderThickness="0" ToolTip="{x:Static prop:Resources.Button_Start}">
                    <Image x:Name="StartImage" Source="start.png" Stretch="Uniform"/>
                </Button>
                <Button x:Name="StopButton" Width="64" Height="64" Margin="5" Click="StopButton_Click" Background="Transparent" BorderThickness="0" ToolTip="{x:Static prop:Resources.Button_Stop}" Visibility="Collapsed">
                    <Image x:Name="StopImage" Source="stop.png" Stretch="Uniform"/>
                </Button>
            </StackPanel>
        </Grid>
    </Grid>
</Window>